## **Ввод и вывод в ассемблере (x86/x86-64, NASM)**  

---

## **1. Ввод-вывод в SASM (SimpleASM)**  

SASM (SimpleASM) - простая кроссплатформенная среда разработки для языков ассемблера NASM, MASM, GAS, FASM с подсветкой синтаксиса и отладчиком. В SASM Вы можете легко разрабатывать и выполнять программы, написанные на языке ассемблера. Вводите код в форму и запускайте приложение. Программа работает "из коробки" и хорошо подойдет для начинающих изучать язык ассемблера. Основана на Qt. Распространяется по свободной лицензии GNU GPL v3.0.

Примеры кода
Работоспособные примеры кода для разных ассемблеров, включая примеры работы с фунциями ввода-вывода и макросами "io.inc", содержатся в папке Projects по пути, где установлен SASM (обычно C:\Program Files (x86)\SASM на Windows, /usr/share/sasm на Linux).

Библиотека макросов для NASM "io.inc"
В программу включена библиотека кроссплатформенных макросов ввода-вывода "io.inc". Для её использования в начале программы нужно добавить директиву %include "io.inc" (%include "io64.inc" для 64-битного ассемблера). Подробнее о ее командах Вы можете узнать здесь: http://asmcourse.cs.msu.ru/?page_id=169 или ниже.
x86-64 "io64.inc"

| Имя макроса |	Описание макроса |
|-------------|------------------|
| PRINT_UDEC size, data / PRINT_DEC size, data | Вывод числовых данных заданных параметром data в 10-чном представлении. Параметр size – число, указывающее размерность данных в байтах; допускаются значения 1, 2, 4, 8 (x64). В качестве параметра data может выступать числовая константа, символьная константа, имя переменной, имя регистра или адресное выражение (без спецификатора размера данных в памяти). Если задается регистр большего размера, то берется заданное параметром size количество младших разрядов. PRINT_UDEC интерпретирует число как беззнаковое, PRINT_DEC — как знаковое.|
| PRINT_HEX size, data | Аналогично предыдущему, но данные выводятся в 16-чном представлении. |
| PRINT_CHAR ch | Печатается символ, заданный параметром ch. В качестве параметра может выступать численная константа, символьная константа, имя переменной, имя регистра или адресное выражение (без спецификатора размера данных в памяти). Печатается всегда содержимое 8 младших разрядов. |
| PRINT_STRING data | Печать строки текста, оканчивающейся символом с кодом 0. В качестве параметра можно передавать строковую константу, имя переменной или адресное выражение (без спецификатора размера данных в памяти). В случае печати строковой константы, наличие символа с кодом 0 в конце строки необязательно. |
| NEWLINE | Макрос переводит печать на новую строку. |
| GET_UDEC size, data
GET_DEC size, data | Ввод числовых данных в 10-чном представлении с клавиатуры. Размер вводимых данных ограничен параметром size, который задается числом (1, 2, 4, 8 (x64)). Введенные данные обрезаются соответствующим образом. Параметр data – либо имя переменной, либо имя регистра, либо адресное выражение (без спецификатора размера данных в памяти). Если задается регистр большего размера, то старшие разряды заполняются знаковым битом в случае GET_DEC и нулями в случае GET_UDEC. GET_UDEC считывает беззнаковое число, GET_DEC — знаковое. Запрещается использовать в качестве параметра регистр esp. |
| GET_HEX size, data | Аналогично предыдущему, но данные задаются в 16-чном представлении с префиксом 0x. |
| GET_CHAR data | Аналогично предыдущему, но происходит считывание одного символа, нажатие Enter не требуется. Более того, нажатие Enter будет расцениваться как ввод управляющих символов перевода строки: 0xD 0xA в ОС Windows, 0xA в ОС *nix. Если параметр – регистр, размер которого больше 1 байта, значение считанного символа будет дополнено нулями. |
| GET_STRING data, maxsz | Ввод последовательности символов длиной не более чем (maxsz-1). Чтение последовательности останавливается на EOF или переводе строки, причем перевод строки сохраняется в буфере. В конец считанной строки добавляется символ с кодом 0. Параметр data – либо имя переменной, либо адресное выражение (без спецификатора размера данных в памяти). Параметр maxsz – регистр или числовая константа. |

---

## **2. Ввод-вывод через системные вызовы (Linux, x86-64)**  

В Linux ввод-вывод выполняется через **syscall**.

### **2.1. Вывод в консоль (`sys_write`)**  
**Системный вызов:**  
- `rax = 1` (номер `sys_write`)  
- `rdi = 1` (stdout)  
- `rsi = адрес строки`  
- `rdx = длина строки`  

```assembly
section .data
msg db "Hello, world!", 10  ; Сообщение + символ новой строки
len equ $ - msg             ; Длина строки

section .text
global _start

_start:
    mov rax, 1      ; sys_write
    mov rdi, 1      ; stdout
    mov rsi, msg    ; Адрес строки
    mov rdx, len    ; Длина строки
    syscall

    mov rax, 60     ; sys_exit
    xor rdi, rdi    ; Код возврата 0
    syscall
```

---

### **2.2. Ввод строки (`sys_read`)**  
**Системный вызов:**  
- `rax = 0` (номер `sys_read`)  
- `rdi = 0` (stdin)  
- `rsi = буфер для ввода`  
- `rdx = максимальная длина`  

```assembly
section .bss
buffer resb 32  ; Буфер на 32 байта

section .text
global _start

_start:
    mov rax, 0      ; sys_read
    mov rdi, 0      ; stdin
    mov rsi, buffer ; Адрес буфера
    mov rdx, 32     ; Максимальная длина
    syscall

    ; Вывод введённого текста
    mov rax, 1
    mov rdi, 1
    mov rsi, buffer
    mov rdx, 32
    syscall

    mov rax, 60     ; sys_exit
    xor rdi, rdi
    syscall
```

---

## **3. Ввод-вывод через библиотеку C (printf, scanf)**  

### **3.1. Подключение стандартной библиотеки (`printf`)**  

**Компиляция (Linux, GCC + NASM):**  
```sh
nasm -f elf64 prog.asm && gcc prog.o -o prog -no-pie
```

### **3.2. Вывод через `printf`**  
```assembly
section .data
fmt db "Number: %d", 10, 0  ; Форматная строка

section .text
extern printf
global main

main:
    sub rsp, 8      ; Выравнивание стека (SysV ABI)
    mov edi, fmt    ; Первый аргумент (адрес строки)
    mov esi, 42     ; Второй аргумент (число)
    xor eax, eax    ; Очистка rax (требование printf)
    call printf

    add rsp, 8
    ret
```

---

### **3.3. Ввод через `scanf`**  
```assembly
section .bss
number resd 1  ; 4-байтовая переменная

section .data
fmt db "%d", 0  ; Формат для числа

section .text
extern scanf
global main

main:
    sub rsp, 8
    mov edi, fmt
    mov rsi, number
    xor eax, eax
    call scanf

    ; Вывести введённое число
    mov edi, fmt
    mov esi, [number]
    xor eax, eax
    call printf

    add rsp, 8
    ret
```

---

## **Сравнение методов ввода-вывода**  

| Метод | ОС | Преимущества | Недостатки |
|--------|----|-------------|------------|
| SASM (`print`, `scan`) | Windows | Простой синтаксис | Только в SASM |
| `syscall` | Linux | Нативный вызов ОС | Долгая настройка |
| `printf`, `scanf` | Linux, Windows | Гибкость, поддержка форматов | Требует libc |

