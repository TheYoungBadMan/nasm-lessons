## **–°—Ç–µ–∫ –∏ —Å—Ç–µ–∫–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ x86-64**  

### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–∫?**  
–°—Ç–µ–∫ ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **LIFO** (Last In, First Out). –í x86-64 —Å—Ç–µ–∫ —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑: **–∞–¥—Ä–µ—Å–∞ —É–º–µ–Ω—å—à–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö**.  

- **–í–µ—Ä—à–∏–Ω–∞ —Å—Ç–µ–∫–∞** ‚Äî –∞–¥—Ä–µ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä `RSP` (Stack Pointer).  
- **–ë–∞–∑–æ–≤—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞ (`RBP`)** ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É —Å—Ç–µ–∫–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö.  

---

### **2. –†–µ–≥–∏—Å—Ç—Ä—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç–µ–∫–æ–º**  
- **`RSP` (Stack Pointer)** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–µ—Ä—à–∏–Ω—É —Å—Ç–µ–∫–∞.  
- **`RBP` (Base Pointer)** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–µ–∫–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö).  

---

### **3. –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–µ–∫–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**  

#### **(1) PUSH ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–µ–∫–µ**  
- –£–º–µ–Ω—å—à–∞–µ—Ç `RSP` –Ω–∞ 8 –±–∞–π—Ç (–∏–ª–∏ 4 –≤ x86) –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–µ–∫.  
- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:  
  ```assembly
  sub rsp, 8    ; –û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –≤ —Å—Ç–µ–∫–µ
  mov [rsp], rax ; –ó–∞–ø–∏—Å–∞—Ç—å rax –≤ —Å—Ç–µ–∫
  ```

–ü—Ä–∏–º–µ—Ä:  
```assembly
push rax  ; –ó–∞–ø–∏—Å–∞—Ç—å rax –≤ —Å—Ç–µ–∫
push rbx  ; –ó–∞–ø–∏—Å–∞—Ç—å rbx –≤ —Å—Ç–µ–∫
```
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:  
- `RSP` —É–º–µ–Ω—å—à–∏—Ç—Å—è –Ω–∞ 16 –±–∞–π—Ç (2 * 8).  

---

#### **(2) POP ‚Äî –∏–∑–≤–ª–µ—á—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å—Ç–µ–∫–∞**  
- –ß–∏—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `RSP`, –∑–∞—Ç–µ–º —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `RSP`.  
- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:  
  ```assembly
  mov rax, [rsp] ; –ò–∑–≤–ª–µ—á—å –≤–µ—Ä—Ö–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å—Ç–µ–∫–∞
  add rsp, 8     ; –û—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ
  ```

–ü—Ä–∏–º–µ—Ä:  
```assembly
pop rbx  ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å rbx
pop rax  ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å rax
```
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:  
- `RSP` —É–≤–µ–ª–∏—á–∏—Ç—Å—è –Ω–∞ 16 –±–∞–π—Ç.  

---

#### **(3) CALL ‚Äî –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–∫)**  
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —Å—Ç–µ–∫** (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏).  
- **–ü—Ä—ã–≥–∞–µ—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é**.  
- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:  
  ```assembly
  push rip   ; –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
  jmp –∞–¥—Ä–µ—Å  ; –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é
  ```

–ü—Ä–∏–º–µ—Ä:  
```assembly
call foo  ; –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ foo (–∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å—Ç–µ–∫–µ)
```

---

#### **(4) RET ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏**  
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –∏–∑ —Å—Ç–µ–∫–∞ –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É–¥–∞.  
- –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:  
  ```assembly
  pop rip   ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
  ```

–ü—Ä–∏–º–µ—Ä:  
```assembly
foo:
    push rbp
    mov rbp, rsp  ; –ù–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º
    sub rsp, 8    ; –í—ã–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

    mov dword [rsp], 42  ; x = 42

    add rsp, 8     ; –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–µ–∫
    pop rbp
    ret            ; –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ main
```

---

#### **(5) ENTER / LEAVE (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π)**  
- **ENTER `n, 0`** ‚Äî –≤—ã–¥–µ–ª—è–µ—Ç `n` –±–∞–π—Ç –≤ —Å—Ç–µ–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `RBP`.  
- **LEAVE** ‚Äî —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ `MOV RSP, RBP + POP RBP`.  

–ü—Ä–∏–º–µ—Ä:
```assembly
foo:
    enter 8, 0   ; –í—ã–¥–µ–ª–∏—Ç—å 8 –±–∞–π—Ç –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    mov dword [rbp-4], 42  ; x = 42
    leave        ; –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–µ–∫
    ret
```

---

### **4. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–µ–∫–æ–º**  
#### **C-–∫–æ–¥**
```c
void foo(int a, int b) {
    int c = a + b;
}

int main() {
    foo(2, 3);
    return 0;
}
```

#### **–ê—Å—Å–µ–º–±–ª–µ—Ä (x86-64, Linux)**
```assembly
section .text
global main

foo:
    push rbp        ; –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ rbp
    mov rbp, rsp    ; –ù–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º
    sub rsp, 8      ; –í—ã–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é c

    mov eax, [rbp+16] ; a (–ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç)
    add eax, [rbp+24] ; b (–≤—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç)
    mov [rbp-4], eax  ; c = a + b

    leave
    ret

main:
    push rbp
    mov rbp, rsp

    mov edi, 2  ; 1-–π –∞—Ä–≥—É–º–µ–Ω—Ç foo (a)
    mov esi, 3  ; 2-–π –∞—Ä–≥—É–º–µ–Ω—Ç foo (b)
    call foo

    mov eax, 0  ; return 0;
    pop rbp
    ret
```
**–ö–∞–∫ —Å—Ç–µ–∫ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `foo(2, 3)`?**  
1. `call foo` ‚Üí –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ (`rip`) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å—Ç–µ–∫.  
2. –ê—Ä–≥—É–º–µ–Ω—Ç—ã `2` –∏ `3` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö (`edi`, `esi`).  
3. –í `foo` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º (`RBP` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, `RSP` —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è).  
4. `RET` –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `RIP`, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `main`.

---

### **5. –ò—Ç–æ–≥**
- **`PUSH` / `POP`** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è.  
- **`CALL` / `RET`** ‚Äî –≤—ã–∑—ã–≤–∞—é—Ç –∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏.  
- **`RSP`** ‚Äî –≤–µ—Ä—à–∏–Ω–∞ —Å—Ç–µ–∫–∞, **`RBP`** ‚Äî –±–∞–∑–æ–≤—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å —Ñ—Ä–µ–π–º–∞.  
- **–§—Ä–µ–π–º—ã —Ñ—É–Ω–∫—Ü–∏–π** —Ö—Ä–∞–Ω—è—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞.

  ### **–§—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º –≤ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ**  

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è **—Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º (stack frame)** ‚Äî –æ–±–ª–∞—Å—Ç—å –≤ —Å—Ç–µ–∫–µ, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã.  

---

## **1. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–µ–∫–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–∞**  
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏:  
1. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞** (`call` –ø—É—à–∏—Ç `rip` –≤ —Å—Ç–µ–∫).  
2. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã** (–µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç `rbx, rbp, r12-r15`).  
3. **–í—ã–¥–µ–ª—è–µ—Ç—Å—è –º–µ—Å—Ç–æ –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (`sub rsp, —Ä–∞–∑–º–µ—Ä`).  
4. **–†–∞–±–æ—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏** (–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏).  
5. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** (`add rsp, —Ä–∞–∑–º–µ—Ä`).  
6. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤**.  
7. **–í–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é** (`ret`).

---

## **2. –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ**  

### **C-–∫–æ–¥**
```c
int add(int a, int b) {
    return a + b;
}

int main() {
    int x = add(5, 10);
    return x;
}
```

### **–ê—Å—Å–µ–º–±–ª–µ—Ä (x86-64, System V ABI)**  
```assembly
section .text
global main
extern printf

; int add(int a, int b)
add:
    push rbp            ; –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ rbp
    mov rbp, rsp        ; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ rbp
    mov eax, edi        ; a -> eax
    add eax, esi        ; a + b
    pop rbp             ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ rbp
    ret                 ; –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–≤ eax)

; int main()
main:
    push rbp            ; –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ rbp
    mov rbp, rsp        ; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ rbp
    
    mov edi, 5          ; –ü–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (a = 5)
    mov esi, 10         ; –í—Ç–æ—Ä–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç (b = 10)
    call add            ; –í—ã–∑–æ–≤ add(a, b), —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ eax
    
    mov edi, eax        ; –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
    mov eax, 60         ; syscall exit
    syscall             ; –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
```

---

## **3. –†–∞–∑–±–æ—Ä –∫–æ–¥–∞**
üìå **–§—É–Ω–∫—Ü–∏—è `add`**  
- –°–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º** (`push rbp`, `mov rbp, rsp`).  
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (`edi`, `esi`).  
- –°—É–º–º–∏—Ä—É–µ—Ç —á–∏—Å–ª–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`eax`).  
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–µ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (`pop rbp`, `ret`).  

üìå **–§—É–Ω–∫—Ü–∏—è `main`**  
- –í—ã–∑—ã–≤–∞–µ—Ç `add(5, 10)`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã.  
- –ó–∞–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ `eax`.  
- –í—ã–∑—ã–≤–∞–µ—Ç `syscall` –¥–ª—è –≤—ã—Ö–æ–¥–∞.  

---

## **4. –ò—Ç–æ–≥**
- **–°—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º** –Ω—É–∂–µ–Ω –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.  
- **–†–µ–≥–∏—Å—Ç—Ä—ã `rbp` –∏ `rsp`** —É–ø—Ä–∞–≤–ª—è—é—Ç —Å—Ç–µ–∫–æ–º.  
- **–§—É–Ω–∫—Ü–∏–∏ –≤ x86-64 –ø–µ—Ä–µ–¥–∞—é—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã (`rdi`, `rsi`, ...)**.  
- **`call` –ø—É—à–∏—Ç `rip`**, –∞ `ret` –∑–∞–±–∏—Ä–∞–µ—Ç –µ–≥–æ, –≤–æ–∑–≤—Ä–∞—â–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

## **–°—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º, –ø–µ—Ä–µ–¥–∞—á–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**  

### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º?**  
–°—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º (Stack Frame) ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –Ω–∞ —Å—Ç–µ–∫–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç:  
- –ê–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ (`RIP`).  
- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (`RBP` –∏ –¥—Ä—É–≥–∏–µ).  
- –ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–µ–∫).  
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.  

---

### **2. –ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏**  

#### **(1) –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ C**
```c
int sum(int a, int b) {
    int c = a + b;
    return c;
}

int main() {
    int x = sum(5, 7);
    return 0;
}
```

#### **(2) –ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ x86-64 (System V ABI)**  
–í Linux (x86-64) **–ø–µ—Ä–≤—ã–µ 6 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤** –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã:  
- `RDI` ‚Äî –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç  
- `RSI` ‚Äî –≤—Ç–æ—Ä–æ–π  
- `RDX` ‚Äî —Ç—Ä–µ—Ç–∏–π  
- `RCX` ‚Äî —á–µ—Ç–≤—ë—Ä—Ç—ã–π  
- `R8`  ‚Äî –ø—è—Ç—ã–π  
- `R9`  ‚Äî —à–µ—Å—Ç–æ–π  

–û—Å—Ç–∞–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–µ–∫.  

---

### **3. –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å—Ç–µ–∫–µ**  
–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ —Å—Ç–µ–∫–∞**. –û–±—ã—á–Ω–æ —ç—Ç–æ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç `RBP`.  

---

### **4. –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç–∞ —Å—Ç–µ–∫–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–∞**  
–ê—Å—Å–µ–º–±–ª–µ—Ä–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `sum(int a, int b)`:

```assembly
section .text
global main

sum:
    push rbp          ; –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π RBP
    mov rbp, rsp      ; –ù–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º
    sub rsp, 8        ; –í—ã–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

    mov eax, edi      ; eax = a
    add eax, esi      ; eax = a + b
    mov [rbp-4], eax  ; c = a + b
    mov eax, [rbp-4]  ; –≤–µ—Ä–Ω—É—Ç—å c

    leave             ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–∫ (mov rsp, rbp + pop rbp)
    ret               ; –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–∑–æ–≤—É

main:
    push rbp
    mov rbp, rsp

    mov edi, 5       ; a = 5
    mov esi, 7       ; b = 7
    call sum         ; –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏

    mov eax, 0       ; return 0
    pop rbp
    ret
```

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–µ–∫?**
1. **–í `main` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `sum(5,7)`.**  
   - `5` ‚Üí `RDI`, `7` ‚Üí `RSI`.  
   - `call sum` ‚Üí **–∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å—Ç–µ–∫.  
2. **–í `sum` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º.**  
   - `push rbp` ‚Üí —Å—Ç–∞—Ä—ã–π `RBP` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.  
   - `mov rbp, rsp` ‚Üí –Ω–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º.  
   - `sub rsp, 8` ‚Üí –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –º–µ—Å—Ç–æ –¥–ª—è `c`.  
3. **–í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—É–º–º–∞, –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `c`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ.**  
4. **–í—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ (`leave` + `ret`).**  

---

## **–õ–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏, –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏**  

### **1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏**  
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏** –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö (`global`, `extern`).  
- **–õ–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏** –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –º–æ–¥—É–ª–µ.  

–ü—Ä–∏–º–µ—Ä —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏:
```assembly
section .text
global main

main:
    mov eax, 1
    jmp .done

    .error:
        mov eax, -1

    .done:
        ret
```
–ú–µ—Ç–∫–∏ `.error` –∏ `.done` –¥–æ—Å—Ç—É–ø–Ω—ã **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `main`**.  

---

## **–í—ã–≤–æ–¥—ã**  
1. **–ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤** ‚Äî —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã (`RDI`, `RSI` –∏ —Ç. –¥.), –ª–∏–±–æ —á–µ—Ä–µ–∑ —Å—Ç–µ–∫.  
2. **–°—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º** ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å `RBP`, `RSP`.  
3. **–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** ‚Äî —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ —Å—Ç–µ–∫–µ (`[RBP - offset]`).  
4. **–õ–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏** (`.name`) ‚Äî –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏.

## **–†–µ–∫—É—Ä—Å–∏—è –≤ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ (NASM, x86-64)**  

### **1. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–∫—É—Ä—Å–∏—è?**  
–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∞–º—É —Å–µ–±—è, –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç **–±–∞–∑–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è**. –í –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–Ω–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º**, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è:  
- –ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏  
- –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ  
- –ê–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞  

**–ü—Ä–∏–º–µ—Ä:** –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞ \( n! = n \times (n-1)! \).  

---

### **2. –§–∞–∫—Ç–æ—Ä–∏–∞–ª –≤ C**  
```c
int factorial(int n) {
    if (n <= 1)
        return 1;
    return n * factorial(n - 1);
}

int main() {
    int result = factorial(5);
    return 0;
}
```
### **3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ NASM**  
```assembly
section .text
global main

factorial:
    push rbp        ; –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π RBP
    mov rbp, rsp    ; –ù–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º
    sub rsp, 8      ; –í—ã–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (n - 1)

    cmp edi, 1      ; if (n <= 1)
    jle .base_case  ; –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π

    dec edi         ; n - 1
    mov [rbp-4], edi ; –°–æ—Ö—Ä–∞–Ω—è–µ–º (n-1) –≤ —Å—Ç–µ–∫–µ
    call factorial  ; –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤

    mov edi, [rbp-4] ; –ó–∞–≥—Ä—É–∂–∞–µ–º (n-1) –æ–±—Ä–∞—Ç–Ω–æ
    add rsp, 8      ; –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å—Ç–µ–∫ –ø–µ—Ä–µ–¥ —É–º–Ω–æ–∂–µ–Ω–∏–µ–º
    imul eax, edi   ; n * factorial(n - 1)
    jmp .return

.base_case:
    mov eax, 1      ; –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: return 1

.return:
    leave           ; –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–∫ (mov rsp, rbp + pop rbp)
    ret             ; –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–∑–æ–≤—É

main:
    push rbp
    mov rbp, rsp

    mov edi, 5      ; n = 5
    call factorial  ; –í—ã—á–∏—Å–ª—è–µ–º factorial(5)

    mov eax, 0      ; return 0
    pop rbp
    ret
```

---

### **4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–µ–∫?**
1. **–í—ã–∑–æ–≤ `factorial(5)`**  
   - `5` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `EDI`, —Å—Ç–µ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `RBP`.  
   - `4` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–∑–æ–≤.  
2. **–ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Å—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º.**  
3. **–î–æ—Å—Ç–∏–≥–Ω—É–≤ `n=1`, —Å—Ç–µ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è.**  
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–º–Ω–æ–∂–∞—é—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è.**  

---

### **5. –í—ã–≤–æ–¥—ã**
‚úÖ **–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å—Ç–µ–∫** (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –≥–ª—É–±–∏–Ω–æ–π).  
‚úÖ **–ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é —Ä–µ–∫—É—Ä—Å–∏—é.**  
‚úÖ **–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–µ–∫–µ.**
